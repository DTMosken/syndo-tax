<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
	<th:block th:include="include :: header('财政专项资金拨付')" />
	<th:block th:include="include :: select2-css" />
	<style type="text/css">
		.form-horizontal {margin: 15px 15px 0 15px}
		.container-div {overflow-y: hidden;}
		.input-between {display: flex}
		.input-between input {flex: 6}
		.input-between span {flex: 1;text-align: center;line-height: 28px;}
	</style>
</head>
<body class="gray-bg">
<div class="container-div">
	<div class="row">
		<div class="col-sm-12 search-collapse">
			<form id="query-form">
				<input id="gucode" name="gucode" th:value="${meta.gucode}" type="hidden" />
				<input id="customParams" name="customParams" type="hidden" />
				<div class="select-list">
					<ul>
						<li>
							企业名称：<input type="text" name="qymc"/>
						</li>
						<li class="select-time">
							<label style="width: 100px;">数据所属期： </label>
							<input type="text" class="time-input" id="startTime" placeholder="开始时间" name="params[beginTime]" data-format="yyyy-MM"/>
							<span>-</span>
							<input type="text" class="time-input" id="endTime" placeholder="结束时间" name="params[endTime]" data-format="yyyy-MM"/>
						</li>
						<li>
							<a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
							<a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
						</li>
					</ul>
				</div>
			</form>
		</div>

		<div class="btn-group-sm" id="toolbar" role="group">
			<a class="btn btn-success" onclick="$.operate.add()" shiro:hasPermission="czjbmfg:czzxzjbf:addView">
				<i class="fa fa-plus"></i> 新增
			</a>
			<a class="btn btn-primary single disabled" onclick="$.operate.edit()" shiro:hasPermission="czjbmfg:czzxzjbf:editView">
				<i class="fa fa-edit"></i> 修改
			</a>
			<a class="btn btn-danger multiple disabled" onclick="$.operate.removeAll()" shiro:hasPermission="czjbmfg:czzxzjbf:remove">
				<i class="fa fa-remove"></i> 删除
			</a>
			<a class="btn btn-warning" onclick="optExcel()">
				<i class="fa fa-download"></i> 导入
			</a>
			<a class="btn btn-primary" onclick="downloadTemplate()">
				<i class="fa fa-file-excel-o"></i> 模板
			</a>
			<a class="btn btn-info"onclick="optExcelOption()" shiro:hasPermission="|module:dataImp:${meta.gucode}:export|">
				<i class="fa fa-upload"></i> 导出
			</a>
			<a class="btn btn-warning" onclick="currentNoData()">
				<i class="fa fa-tag"></i> 当期无数据
			</a>
		</div>

		<div class="col-sm-12 select-table table-bordered">
			<table id="bootstrap-table"></table>
		</div>
	</div>
</div>
<th:block th:include="include :: footer" />
<th:block th:include="include :: select2-js" />
<th:block th:include="include :: bootstrap-table-resizable-js" />
<script th:inline="javascript">
    //var editFlag = [[${@permission.hasPermi('system:role:edit')}]];
    //var removeFlag = [[${@permission.hasPermi('system:role:remove')}]];
    var prefix = ctx + "zhzs/czjbmfg/czzxzjbf";
    var dcprefix = ctx + "module/dataImp"

    $(function() {
        var options = {
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            showExport: false,
            modalName: "财政专项资金拨付",
            columns: [{
                checkbox: true
            },
                {
                    field: 'id',
                    visible: false
                },
                {
                    field: 'sjssq',
                    width: '80',
                    title: '数据所属期',
                    sortable: true
                },
                {
                    field: 'ks',
                    width: '80',
                    title: '科室',
                    sortable: true
                },
                {
                    field: 'nsrsbh',
                    width: '120',
                    title: '纳税人识别号',
                    sortable: true
                },
                {
                    field: 'qymc',
                    width: '120',
                    title: '企业名称',
                    sortable: true
                },
                {
                    field: 'xmnr',
                    width: '80',
                    title: '项目内容',
                    sortable: true
                },
                {
                    field: 'bfjey',
                    width: '80',
                    title: '拨付金额(元)',
                    sortable: true
                },
                {
                    field: 'zfyt',
                    width: '80',
                    title: '支付用途',
                    sortable: true
                },
                {
                    field: 'bfsj',
                    width: '80',
                    title: '拨付时间',
                    sortable: true
                } ]
        };
        $.table.init(options);
    });

    // <!--/* 导出模板 */-->
    function downloadTemplate() {
        var filePath = [[${meta.filePath}]];
        // <!--/* 未上传模板，直接根据元数据生成模板 */-->
        if (!filePath) {
            $.modal.loading("正在下载模板，请稍后...");
            var gucode = [[${meta.gucode}]];
            $.post(dcprefix + '/downloadTemplate', {gucode: gucode}, function(result) {
                if (result.code == web_status.SUCCESS) {
                    window.location.href = ctx + "common/excelDownload?fileName=" + encodeURI(result.msg) + "&delete=" + true;
                } else if (result.code == web_status.WARNING) {
                    $.modal.alertWarning(result.msg)
                } else {
                    $.modal.alertError(result.msg);
                }
                $.modal.closeLoading();
            });
        } else {
            window.location.href = ctx + "common/dbTemplateDownload?fileName=" + filePath;
        }
    }

    /*导入*/
    function optExcel() {
        var url = dcprefix + "/impExcel?gucode=" + [[${meta.gucode}]];
        layer.open({
            type: 2,
            id: 'optExcel',
            title: '【从Excel导入】',
            area: ['700px', '450px'],
            content: url,
            shade: 0.3,
            shadeClose: true,
            maxmin: false,
            btn: ['导入', '关闭'],
            yes: function(index, layero) {
                var iframeWin = layero.find('iframe')[0];
                iframeWin.contentWindow.submitHandler();
            },
            cancel: function(index) {
                $.table.refresh();
            }
        });
    }


    // <!--/* 导出选项 */-->
    function optExcelOption() {
        var url = dcprefix + "/optExcelOption/[(${meta.gucode})]";
        layer.open({
            type: 2,
            id: 'optExcel',
            title: 'Excel导出选项',
            area: ['800px', '500px'],
            content: url,
            shade: 0.3,
            shadeClose: true,
            maxmin: false,
            btn: ['导出','关闭'],
            yes: function(index, layero) {
                var iframeWin = layero.find('iframe')[0];
                iframeWin.contentWindow.submitHandler();
            }
        });
    }

    // <!--/* 获得父窗体参数 */-->
    function getParams() {
        var data = $('#query-form').serializeArray();
        var json = {};
        $.each(data, function(i, field) {
            json[field.name] = field.value;
        });
        var table = $("#bootstrap-table").bootstrapTable('getOptions');
        json.pageSize = table.pageSize;
        json.pageNum = table.pageNumber;
        json.count = table.totalRows;
        json.searchValue = table.searchText;
        json.orderByColumn = table.sortName;
        json.isAsc = table.sortOrder;
        return json;
    }


    // <!--/* 当期无数据 */-->
    function currentNoData() {
        $.modal.confirm("确定当期无此指标数据吗?", function() {
            var url = dcprefix + "/currentNoData";
            var data = {"gucode": [[${meta.gucode}]] };
            $.operate.submit(url, "post", "json", data);
        });
    }

</script>
</body>
</html>