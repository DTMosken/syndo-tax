<!DOCTYPE HTML>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
	<meta charset="utf-8">
	<head>
		<th:block th:include="include :: header('抽样推送风险表单')" />
	</head>
	<body class="white-bg">
	    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
	        <form class="form-horizontal m" id="form-gajxjgwh-edit" th:object="${entity}">
				<input id="tsfs" name="tsfs" value="1" type="hidden"/>
	            <div class="form-group">
					<label class="col-sm-2 control-label">抽样数量：</label>
	                <div class="col-sm-2">
	                    <input id="cysl" name="cysl" value="10" class="form-control"  type="number" min="1">
	                </div>
					<div class="col-sm-2">
	                    <button type="button" class="layui-btn layui-btn layui-btn-normal layui-btn-sm layui-btn-fluid" onclick="cy()">重新抽样</button>
	                </div>
	                <label class="col-sm-2 control-label">指标名称：</label>
	                <div class="col-sm-4">
	                    <input id="zbmc" name="zbmc" th:field="*{zbmc}" class="form-control" type="text">
	                </div>
	            </div>

                <div class="form-group">	
	                <label class="col-sm-2 control-label">指标数据：</label>
	                <div class="col-sm-10">
						<table id="layui-table" lay-filter="layui-table"></table>
	                </div>
	            </div>
				
                <div class="form-group">
                    <label class="col-sm-2 control-label">推送说明： </label>
					<div class="col-sm-10">
						<textarea name="tssm" autocomplete="off" maxlength="500" class="form-control" rows="3"></textarea>
					</div>
				</div>

				<div class="form-group">
                    <label class="col-sm-2 control-label">指定反馈人： </label>
					<div class="col-sm-4">
						<div id="demo1"></div>
					</div>
					<label class="col-sm-2 control-label">反馈限时： </label>
					<div class="col-sm-4">
						<input id="fkxs" name="fkxs"  class="form-control" type="text">
					</div>
				</div>

				<div class="form-group">
                    <label class="col-sm-2 control-label">推送人： </label>
					<div class="col-sm-4">
						<input id="tsrmc" name="tsrmc" th:field="*{tsrmc}" class="form-control" type="text">
					</div>
					<label class="col-sm-2 control-label">推送时间： </label>
					<div class="col-sm-4">
						<input id="tssj" name="tssj" th:field="*{tssj}" class="form-control" type="text">
					</div>
				</div>

			</form>
	    </div>
	    <th:block th:include="include :: footer" />
        <script th:inline="javascript">
            var zbdm = /*[[${entity.zbdm}]]*/
            function getLocalData() {
                return JSON.parse(sessionStorage.getItem(zbdm));
            }
            
        </script>
	    <script type="text/javascript">
			var prefix = ctx + "zhzs/dbfxxt/xtgl/gajxjgwh";



			layui.use(['table','xmSelect'],function(){
				var table = layui.table;
				var xmSelect = layui.xmSelect;
				
				var demo1 = xmSelect.render({
					el: '#demo1', 
					prop: {
						name: 'username',
						value: 'username',
					},
					theme: {
						color: '#1E9FFF'
					},
					model: {
						label: {
							type: 'text',
							text: {
								left: '',
								right: '',
								separator: ', '
							}
						}
					},
					content: `
						<table class="layui-table" lay-filter="demo">
						<thead>
							<tr>
							<th lay-data="{field:'username', width:80}">昵称</th>
							<th lay-data="{field:'experience', width:50}">积分</th>
							<th lay-data="{field:'sign', width:200}">签名</th>
							</tr> 
						</thead>
						<tbody>
							<tr>
							<td>贤心1</td>
							<td>66</td>
							<td>人生就像是一场修行a</td>
							</tr>
							<tr>
							<td>贤心2</td>
							<td>88</td>
							<td>人生就像是一场修行b</td>
							</tr>
							<tr>
							<td>贤心3</td>
							<td>33</td>
							<td>人生就像是一场修行c</td>
							</tr>
						</tbody>
						</table>
					`,
					height: 'auto',
				});

				// table.render('demo')
				table.init('demo', {
					id: 'demo',
					done: function(res){
						demo1.update({ data: res.data })
					}
				})
				table.on('row(demo)', function(obj){
					console.log('sssssssssssssssss')
					var values = demo1.getValue();
					var item = obj.data;
					var has = values.find(function(i){
						return i.username === item.username
					})
					if(has){
						demo1.delete([ item ]);
					}else{
						values.forEach(function(_item){demo1.delete([_item])});
						demo1.append([ item ]);
					}
					
				})
			})


			$("#form-gajxjgwh-edit").validate({
				// 表单验证，参考notes文件
				rules:{	
					jxmc:{
						required:true
					},
					sqzjcx:{
						required:false
					},
					jg:{
						required:false,
						number:true
					},
					kssj:{
						required:false
					},
					jssj:{
						required:false
					}
				}
			});
			
			function submitHandler() {
                alert('submitHandler!');
		        // if ($.validate.form()) {
		        // 	$.operate.save(prefix + "/edit", $('#form-gajxjgwh-edit').serialize());
		        // }
		    }
			function buildWhere(localData) {
				return $.extend({}, localData.where, {tsfs: $('#tsfs').val(), cysl: $('#cysl').val()});
			}
            layui.use('table', function() {
                var table = layui.table;
                // table.reload('table1', {data: getLocalData()})				
				var localData = getLocalData();
				table.render({
					id: 'layui-table',
					elem: '#layui-table',
					url: localData.url,
					where: buildWhere(localData),
					height: 300,
					even: false,
					size: 'sm',
					method: 'post',
					page: false,
					toolbar: false,
					cols: localData.cols
				});
				
				window.cy = function() {
					table.reload('layui-table', {
						url: localData.url,
						where: buildWhere(localData),
						page: false
					});
				}
            });
			layui.use('laydate', function(){
	        	var laydate = layui.laydate;
	    	  	laydate.render({elem: '#kssj', type: 'month', format: 'yyyy-MM'});
	    	  	laydate.render({elem: '#jssj', type: 'month', format: 'yyyy-MM'});
		    });
		</script>
	</body>
</html>
