<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
	<meta charset="utf-8">
	<head>
		<th:block th:include="include :: header('按行业用电分析')" />
		<th:block th:include="include :: select2-css" />
	</head>
	<body class="gray-white">
	     <div class="container-div">
			<div class="row">
				<!-- 查询条件 -->
		    	<div class="panel panel-default">
					<div class="panel-heading">
						<h4 class="panel-title">
							<i class="fa fa-search"></i>&nbsp;&nbsp;查询条件选择
							<a data-toggle="collapse" data-parent="#accordion" href="#collapseExample" class="collapse-a">
								<span class="fa fa-chevron-down"></span>
							</a>
						</h4>
					</div>
					<div id="collapseExample" class="panel-collapse collapse">
						<form id="query-form" class="form-horizontal m">
				        	<div class="row">
				        		<div class="col-sm-4">
				        			<div class="form-group">
										<label class="col-sm-3 control-label input-sm">纳税人名称： </label>
										<div class="col-sm-9">
											<input class="form-control input-sm" type="text" id="nsrmc"/>
										</div>
									</div>
								</div>
				        		<div class="col-sm-4">
				        			<div class="form-group">
										<label class="col-sm-3 control-label input-sm">所属期起： </label>
										<div class="col-sm-9">
											<input class="form-control input-sm" type="text" readonly="readonly" id="ssqq" name="ssqq" th:value="*{ssqq}"/>
										</div>
									</div>
								</div>
				        		<div class="col-sm-4">
				        			<div class="form-group">
										<label class="col-sm-3 control-label input-sm">所属期止： </label>
										<div class="col-sm-9">
											<input class="form-control input-sm" type="text" readonly="readonly" id="ssqz" name="ssqz" th:value="*{ssqz}"/>
										</div>
									</div>
								</div>
				        		<div class="col-sm-4">
				        			<div class="form-group">
										<label class="col-sm-3 control-label input-sm">行业门类： </label>
										<div class="col-sm-9">
											<select id="sshy" name="sshy" th:with="type=${@dict.getType('dm_dbfxxt_sydbfzfx_hyml')}" class="form-control select2-multiple">
												<option value=""></option>
												<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
											</select>
										</div>
									</div>
								</div>
								<div class="col-sm-4 text-right">
									<a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
									<a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
								</div>
							</div>
						</form>
					</div>
				</div>
				
				<div class="col-sm-12 select-table table-striped">
					<table id="bootstrap-table" data-mobile-responsive="true"></table>
				</div>
			</div>
		</div>
	    <th:block th:include="include :: footer" />
	    <th:block th:include="include :: select2-js" />
	    <script th:inline="javascript">
	        var prefix = ctx + "zhzs/dbfxxt/sybdfzfx/ahyydfx";
	
	        $(function() {
	            var options = {
	                //url: prefix + "/list",
	                modalName: "按行业用电分析",
			        showExport: true,
			        showSearch: false,
	                columns: [{
			            checkbox: true
			        },
			        {
						field : 'ssqq', 
						title : '所属期起',
						width : '80'
					},
					{
						field : 'ssqz', 
						title : '所属期止',
						width : '80'
					},
					{
						field : 'nsrmc', 
						title : '企业名称',
						width : '200'
					},
					{
						field : 'sshy', 
						title : '所属行业',
						width : '250'
					},
					{
						field : 'qyydl', 
						title : '企业用电量',
						width : '100'
					},
					{
						field : 'qynse', 
						title : '企业纳税额',
						width : '100'
					},
					{
						field : 'dlcse', 
						title : '电量产税额',
						width : '100'
					},
			        {
						field : 'detail',
			            title: '操作',
			            width: '100',
			            align: 'center',
			            formatter: function(value, row, index) {
			            	var actions = [];
			                actions.push('<a class="btn btn-info btn-xs" href="#" title="图表" onclick="onCharts(\'' + row.nsrmc + '\')"><i class="fa fa-list"></i> 查看图表</a> ');
			                return actions.join('');
			            }
			        }]
	            };
	            $.table.init(options);
	        });
	        
	        function onCharts(nsrmc) {
	        	var data = $('#query-form').serialize();
	        	var url = prefix + "/getChart?" + data + "&nsrmc=" + nsrmc;
	    		layer.open({
	    			title: false,
			        type: 2,
			        closeBtn: true,
			        shadeClose: true,
					area: ['80%', '100%'],
					content: url
	      		}); 
	        }
	        
	        layui.use('laydate', function(){
	        	var laydate = layui.laydate;
				laydate.render({
				  	elem: '#ssqq',
				  	format: 'yyyy-MM',
				  	type: 'month'
				});
				laydate.render({
				  	elem: '#ssqz',
				  	format: 'yyyy-MM',
				  	type: 'month'
				});
			});
	    </script>
	</body>
</html>