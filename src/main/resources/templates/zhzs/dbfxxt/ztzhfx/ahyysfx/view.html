<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head>
	<th:block th:include="include :: header('按行业用水分析')" />
	<th:block th:include="include :: select2-css" />
</head>
<body class="gray-white">
     <div class="container-div">
		<div class="row">
		
			<!-- 查询条件 -->
	    	<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<i class="fa fa-search"></i>&nbsp;&nbsp;查询条件选择
						<a data-toggle="collapse" data-parent="#accordion" href="#collapseExample" class="collapse-a">
							<span class="fa fa-chevron-down"></span>
						</a>
					</h4>
				</div>
				<div id="collapseExample" class="panel-collapse collapse">
					<form id="query-form" class="form-horizontal m">
			        	<div class="row">
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">纳税人名称： </label>
									<div class="col-sm-9">
										<input class="form-control input-sm" type="text" id="nsrmc" name="nsrmc"/>
									</div>
								</div>
							</div>
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">所属期起： </label>
									<div class="col-sm-9">
										<input class="form-control input-sm" type="text" readonly="readonly" id="cxsjq" name="cxsjq" th:value="*{cxsjq}"/>
									</div>
								</div>
							</div>
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">所属期止： </label>
									<div class="col-sm-9">
										<input class="form-control input-sm" type="text" readonly="readonly" id="cxsjz" name="cxsjz" th:value="*{cxsjz}"/>
									</div>
								</div>
							</div>
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">行业门类： </label>
									<div class="col-sm-9">
										<select id="sshy" name="sshy" th:with="type=${@dict.getType('dm_ml')}" class="form-control select2-multiple">
											<option value=""></option>
											<option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictLabel}"></option>
										</select>
									</div>
								</div>
							</div>
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">用水量大于： </label>
									<div class="col-sm-9">
										<input class="form-control input-sm" type="text" id="yslq" name="yslq"/>
									</div>
								</div>
							</div>
			        		<div class="col-sm-4">
			        			<div class="form-group">
									<label class="col-sm-3 control-label input-sm">用水量小于： </label>
									<div class="col-sm-9">
										<input class="form-control input-sm" type="text" id="yslz" name="yslz"/>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-12 text-right">
								<a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
								<a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
							</div>
						</div>
					</form>
				</div>
			</div>
			
	        <div class="btn-group-sm" id="toolbar" role="group">
			</div>
			<div class="col-sm-12 select-table table-striped">
				<table id="bootstrap-table" data-mobile-responsive="true"></table>
			</div>
		</div>
	</div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: select2-js" />
    <script th:inline="javascript">
        var prefix = ctx + "zhzs/dbfxxt/ztzhfx/ahyysfx";

        $(function() {
            var options = {
                url: prefix + "/list",
                modalName: "按行业用水分析",
                showSearch: false,
		        showExport: true,
                columns: [{
		            checkbox: true
		        },
				{
					field : 'obj_id', 
					visible: false
				},
				{
					field : 'nsrsbh', 
					title : '纳税人识别号',
					sortable: true,
					width: 150
				},
				{
					field : 'nsrmc', 
					title : '纳税人名称',
					sortable: true,
					width: 200,
					formatter: function(value, row, index) {
						return '<span title="'+value+'">'+value+'</span>'
					}
				},
				{
					field : 'qyysl', 
					title : '企业用水量',
					sortable: true,
					align: 'right',
					width: 150
				},
				{
					field : 'qynse', 
					title : '企业纳税额',
					sortable: true,
					align: 'right',
					width: 150
				},
				{
					field : 'slcse', 
					title : '水量产税额',
					sortable: true,
					align: 'right',
					width: 150
				},
				{
					field : 'yf', 
					title : '所属月份',
					sortable: true,
					width: 150
				},
				{
					field : 'hyml', 
					title : '行业',
					sortable: true,
					width: 150
				}
				,
		        {
					field : 'detail',
		            title: '操作',
		            width: '10%',
		            align: 'center',
		            formatter: function(value, row, index) {
		            	var actions = [];
		                actions.push('<a class="btn btn-info btn-xs" href="#" title="查看图表" onclick="onCktb(\'' + row.nsrmc + '\',\'' + row.yf + '\')"><i class="fa fa-list"></i> 查看图表</a> ');
		                return actions.join('');
		            }
		        }]
            };
            $.table.init(options);
        });
        function onCktb(nsrmc,yf){
        	var url=prefix + "/getChart?nsrmc="+encodeURIComponent(nsrmc)+"&yf="+encodeURIComponent(yf);
    		layer.open({
      		  type: 2, 
      		  title:(!!yf?yf.substring(0,4):new Date().getFullYear())+'年'+nsrmc+'纳税额与用水量',
      		  area: ['80%', '100%'],
      		  content: url
      		}); 
        }
        layui.use('laydate', function(){
        	var laydate = layui.laydate;
      	  //执行一个laydate实例
      	  laydate.render({
      	    elem: '#cxsjq', //指定元素
      	    format:'yyyy-MM'
      	  });
      	  //执行一个laydate实例
      	  laydate.render({
      	    elem: '#cxsjz', //指定元素
      	    format:'yyyy-MM'
      	  });
      });
    </script>
</body>
</html>